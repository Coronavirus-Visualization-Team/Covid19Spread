import requests
from urllib.parse 
import urlencode

def search_place(gps, api_key):
    # Send request by API
    response = requests.get(
        'https://maps.googleapis.com/maps/api/place/nearbysearch/json?' + urlencode(
            {'location': gps, 'rankby': 'distance', 'name': 'franprix', 'key': api_key}))
    # Read response as json
    resp_address = response.json()
    # status=OK: the place was successfully detected and at least one result was returned
    if resp_address['status'] == 'OK':
        lat = resp_address['results'][0]['geometry']['location']['lat']
        lng = resp_address['results'][0]['geometry']['location']['lng']
        vicinity_addr = resp_address['results'][0]['vicinity']
        place_id = resp_address['results'][0]['place_id']
        glb_rating = resp_address['results'][0]['rating']
        totnb_reviews = resp_address['results'][0]['user_ratings_total']
        return place_id
    else:
        print('Failed to get json response:', resp_address)
        return ['place_id is not found', gps]
        
def get_place_details(gps, api_key):
    # Send request by API
    place_id = search_places(gps, api_key)
    response = requests.get(
        'https://maps.googleapis.com/maps/api/place/details/json?' + urlencode({'place_id': place_id, 'key': api_key}))
    # Read response as json
    resp_details = response.json()
    # status=OK: the place was successfully detected and at least one result was returned
    for i in range(len(resp_details)):

    if resp_details['status'] == 'OK':
        for i in range(len(resp_details)):
            review_rating = resp_details['result']['reviews'][i]['rating']
            review_timestamp = resp_details['result']['reviews'][i]['time']
            review_text = resp_details['result']['reviews'][i]['text']
            return [place_id, review_rating, review_timestamp, review_text]
    else:
        print('Failed to get json response:', resp_details)
        return ['Review is not found', place_id]
