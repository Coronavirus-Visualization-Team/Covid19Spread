# get place_id from location
import requests
import json
import csv
from urllib.parse import urlencode

api_key = AIzaSyBfKiv4bXLC9Qbebjyj2MFfGU3DzHKYPkY
path = "C:\Users\Maya Chande\Downloads\Businesses_Output.csv"

def get_coords(path):
    try:
        df = pd.read_csv(path)
        lats = []
        longs = []
        for i in range(df.index.size):
            coords.append(df.loc[i].values[4])
            coords.append(df.loc[i].values[5])
    except:
        print(path)
        print("Error opening file")
        exit(0)
    coords = []
    for i in range(len(lats)):
        coords[i] = (lats[i],longs[i])
    return coords
    
def get_place_id(coords):
    ids = []
    for i in range(len(coords)):
        response = requests.get(
        'https://maps.googleapis.com/maps/api/place/nearbysearch/json?' + urlencode({'location': coords[i], 'rankby': 'distance', 'name': 'franprix', 'key': api_key}))
        content = response.content
        output = json.loads(content)
        place_id = output['results'][0]['place_id']
        ids.append(place_id)
    return ids
    
def get_reviews(ids):
    for i in range(len(ids)):
        place_id = ids[i]
        response = requests.get('https://maps.googleapis.com/maps/api/place/details/json?' + urlencode({'place_id': place_id, 'key': api_key}))
        content = response.content
        output = json.loads(content)
        review_timestamp = output['result']['reviews'][i]['time']
        review_rating = output['result']['reviews'][i]['rating']
        review_text = output['result']['reviews'][i]['text']
    return [place_id, review_timestamp, review_rating, review_text]
        
    
